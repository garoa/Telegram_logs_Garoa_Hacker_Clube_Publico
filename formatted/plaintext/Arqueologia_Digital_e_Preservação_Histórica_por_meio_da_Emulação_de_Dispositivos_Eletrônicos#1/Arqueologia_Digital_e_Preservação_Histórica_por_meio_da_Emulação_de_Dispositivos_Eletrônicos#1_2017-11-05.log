[2017-11-05 00:02:09] Werner Eck: https://github.com/ppeccin/javatari.js
[2017-11-05 00:02:30] Felipe "Juca" Sanches: Esse cara fez emulador de MSX tamb√©m, se n√£o me engano
[2017-11-05 00:02:54] Werner Eck: sim
[2017-11-05 00:03:13] Werner Eck: https://github.com/ppeccin/WebMSX
[2017-11-05 00:03:21] Felipe "Juca" Sanches: exato!
[2017-11-05 00:31:56] Felipe "Juca" Sanches: Esse trecho de c√≥digo aqui logo no in√≠cio do boot do sagitta180 (rom do 150) preenche a regi√£o de 0x8000 at√© 0x8fff (4kbytes) com o valor 0x20 (caractere espa√ßo):
[2017-11-05 00:32:04] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804726048_39811.jpg
[2017-11-05 00:32:43] Felipe "Juca" Sanches: s√≥ n√£o entendo pra que ele usa o contador no registrador C com o valor 2, que faz ele executar a escrita duas vezes
[2017-11-05 00:33:33] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804722809_61130.jpg
[2017-11-05 00:35:04] Werner Eck: vc j√° conseguiu parsear a rom pra conseguir obter j√° os opcodes e operandos separadamente?
[2017-11-05 00:35:27] Werner Eck: ah j√° deve ter emula√ß√£o da CPU 8080 pronta no MAME n√©?
[2017-11-05 00:35:33] Felipe "Juca" Sanches: sim
[2017-11-05 00:35:41] Werner Eck: vc n√£o precisou fazer essa parte
[2017-11-05 00:35:52] Felipe "Juca" Sanches: simplesmente instanciei o I8080 e carreguei a ROM nele
[2017-11-05 00:36:01] Felipe "Juca" Sanches: e j√° t√¥ com c√≥digo rodando
[2017-11-05 00:36:02] Werner Eck: certo, q nem no Zezinho
[2017-11-05 00:36:06] Felipe "Juca" Sanches: isso
[2017-11-05 00:36:12] Werner Eck: com tela e td?
[2017-11-05 00:36:32] Felipe "Juca" Sanches: s√≥ que no caso do zezinho a gente escreveu a emula√ß√£o da CPU. E nesse caso, usei um m√≥dulo de emula√ß√£o que o MAME j√° tinha
[2017-11-05 00:36:52] Werner Eck: tendi
[2017-11-05 00:37:03] Felipe "Juca" Sanches: instanciei tamb√©m o chip CRTC (gerador de v√≠deo) modelo I8275, da intel tamb√©m. Que o MAME tamb√©m emula
[2017-11-05 00:37:13] Felipe "Juca" Sanches: e declarei que tem uma tela com alguma resolu√ß√£o chutada
[2017-11-05 00:37:25] Werner Eck: onde ele decrementa esse registrador c?
[2017-11-05 00:37:33] Felipe "Juca" Sanches: come√ßando torto pra ir achando o caminho
[2017-11-05 00:37:44] Werner Eck: e ele t√° pegando direitinho a tela?
[2017-11-05 00:37:45] Felipe "Juca" Sanches: instru√ß√£o dcr c (decrement C register)
[2017-11-05 00:38:04] Werner Eck: ah vdd n√£o tinha visto ela
[2017-11-05 00:38:17] Felipe "Juca" Sanches: ent√£o... ainda t√° com a tela preta
[2017-11-05 00:38:24] Werner Eck: pq da√≠ ent√£o √© s√≥ vc setar um breakpoint nessa linha e ir acompanhando
[2017-11-05 00:38:34] Werner Eck: ele n√£o escreve nada?
[2017-11-05 00:38:46] Felipe "Juca" Sanches: eu botei uma ROM de CRTC de outro driver, por que a ROM do terminal eu ainda n√£o consegui fazer odump
[2017-11-05 00:38:52] Werner Eck: aaah
[2017-11-05 00:39:01] Werner Eck: pode ser q a√≠ esteja o cat's jump
[2017-11-05 00:39:19] Felipe "Juca" Sanches: a tela t√° preta por que o driver n√£o t√° correto. Mas a ROM do outro CRTC √© razo√°vel. Eu deveria ver algo.
[2017-11-05 00:39:43] Felipe "Juca" Sanches: o MAME tem um modo de visualiza√ß√£o de tiles que √© ativado pressionando F4
[2017-11-05 00:40:02] Werner Eck: e mesmo nesse modo, nada?
[2017-11-05 00:40:28] Werner Eck: vc n√£o conseguiria ver se ele est√° escrevendo os caracteres na mem√≥ria de v√≠deo?
[2017-11-05 00:40:31] Felipe "Juca" Sanches: e ele me mostra isso:
[2017-11-05 00:40:38] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805512853_31540.jpg
[2017-11-05 00:40:49] Werner Eck: tipo qdo a gente visualizou a RAM do zezinho
[2017-11-05 00:41:07] Felipe "Juca" Sanches: sim, consigo. E ele est√° sim escrevendo a string l√°
[2017-11-05 00:41:11] Felipe "Juca" Sanches: deixa eu mostrar...
[2017-11-05 00:42:19] Felipe "Juca" Sanches: Logo depois de encher o buffer de v√≠deo com 0x20, o c√≥digo faz isso:
[2017-11-05 00:42:25] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804722650_63194.jpg
[2017-11-05 00:42:56] Felipe "Juca" Sanches: endere√ßo 78: carrega registrador HL com o valor 0776
[2017-11-05 00:43:10] Felipe "Juca" Sanches: endere√ßo 7B: carrega registrador DE com valor 8334
[2017-11-05 00:43:18] Felipe "Juca" Sanches: esses dois valores s√£o ponteiros para mem√≥ria
[2017-11-05 00:43:18] Werner Eck: da√≠ ele carrega o d, e entra numa esp√©cie de loop
[2017-11-05 00:43:23] Werner Eck: certo
[2017-11-05 00:43:44] Felipe "Juca" Sanches: o endere√ßo 8334 t√° dentro daquele bloco de VRAM (entre 8000 e 8fff)
[2017-11-05 00:43:45] Werner Eck: certo
[2017-11-05 00:43:59] Felipe "Juca" Sanches: ent√£o parece que √© onde ele vai escrever alguma coisa no v√≠deo
[2017-11-05 00:44:13] Felipe "Juca" Sanches: e o outro endere√ßo √© na ROM (0x0776)
[2017-11-05 00:44:19] Werner Eck: o q faz a instru√ß√£o stax?
[2017-11-05 00:44:41] Felipe "Juca" Sanches: inspecionando na janela de visualiza√ß√£o de conte√∫do da mem√≥ria, olha s√≥ o que tem l√° no endere√ßo 0776 da ROM:
[2017-11-05 00:45:12] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804722009_63906.jpg
[2017-11-05 00:45:55] Werner Eck: 0x0776 deveria √≠mprimir o 'S'
[2017-11-05 00:46:17] Felipe "Juca" Sanches: sim. S√≥ que esse c√≥digo a√≠ √© um loop
[2017-11-05 00:46:18] Werner Eck: e da√≠ segue incrementando
[2017-11-05 00:46:22] Felipe "Juca" Sanches: que executa 0x23 vezes
[2017-11-05 00:46:26] Werner Eck: eu notei
[2017-11-05 00:46:29] Felipe "Juca" Sanches: que √© o tamanho  da string
[2017-11-05 00:46:48] Felipe "Juca" Sanches: ent√£o ele vai incrementando os ponteiros e faendo a c√≥pia de um byte por vez da ROM para a VRAM
[2017-11-05 00:46:49] Werner Eck: certo, q ele carregou l√° no contador em 0x07f
[2017-11-05 00:47:17] Werner Eck: agora pergunto, vc v√™ esses valores sendo escritos na RAM?
[2017-11-05 00:47:26] Felipe "Juca" Sanches: compara com 0x23. Se for zero pula fora, senao continua
[2017-11-05 00:47:31] Felipe "Juca" Sanches: sim, vejo
[2017-11-05 00:48:30] Felipe "Juca" Sanches: depois de rodar o loop de escrita da string:
[2017-11-05 00:48:33] Werner Eck: e essa √°rea q est√° sendo preenchida com esses valores lidos da EPROM, √© correspondente no MAME, √† √°rea de vram?
[2017-11-05 00:48:36] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804721105_82131.jpg
[2017-11-05 00:49:04] Felipe "Juca" Sanches: pois √©... a√≠ √© que est√° o lance
[2017-11-05 00:49:16] Felipe "Juca" Sanches: eu nunca tinha lidado com esse CRTC da Intel
[2017-11-05 00:49:19] Werner Eck: a partir de 0x8334
[2017-11-05 00:49:36] Felipe "Juca" Sanches (in reply to Werner Eck): exatamante  !
[2017-11-05 00:49:52] Felipe "Juca" Sanches: ou seja, n√£o √© no topo do v√≠deo. Deve ficar um pouco mais pra baixo
[2017-11-05 00:50:03] Werner Eck: eu perguntei pq penso se a 'janela' de visualiza√ß√£o do CRT controller est√° alinhada com essa RAM a√≠
[2017-11-05 00:50:10] Felipe "Juca" Sanches: por que o v√≠deo come√ßa em 0x8000
[2017-11-05 00:50:30] Felipe "Juca" Sanches: aparentemente n√£o vemos nada ainda por que o CRTC n√£o est√° configurado corretamente
[2017-11-05 00:51:01] Werner Eck: ah certo, talvez ele precise de uma inicializa√ß√£o
[2017-11-05 00:51:08] Felipe "Juca" Sanches: uma coisa curiosa desse CRTC da Intel que eu nunca tinha visto antes √© que ele interfaceia com a RAM principal do sistema por meio de um mecanismo de DMA
[2017-11-05 00:51:12] Werner Eck: eu tbm n√£o conhe√ßo esse perif√©rico.
[2017-11-05 00:51:18] Werner Eck: teria q dar uma olhada no ds dele
[2017-11-05 00:51:21] Felipe "Juca" Sanches: olha o datasheet dele aqui: http://www.jbox.dk/rc702/hardware/intel-8275.pdf
[2017-11-05 00:51:54] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805514103_31745.jpg
[2017-11-05 00:53:07] Felipe "Juca" Sanches: ent√£o, se entendi direito, o firmware pode configurar o CRTC pra usar alguma faixa de mem√≥ria arbitr√°ria como VRAM
[2017-11-05 00:53:56] Werner Eck: √© nessa √°rea do bloco de DMA control logic √© q est√° o pulo do gato
[2017-11-05 00:54:14] Werner Eck: eu to dando uma olhada no ds q vc me mandou
[2017-11-05 00:54:38] Felipe "Juca" Sanches: eu vi um trecho de c√≥digo de boot do terminal que √© MUITO suspeito e que acontece antes da rotina de limpar a tela com espa√ßos:
[2017-11-05 00:54:43] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804721454_81459.jpg
[2017-11-05 00:55:18] Felipe "Juca" Sanches: isso a√≠ escreve 0x8000 na porta 0x44 e depois escreve 0x8FFF na porta 0x45
[2017-11-05 00:55:55] Felipe "Juca" Sanches: parece ser a configura√ß√£o de faixa de endere√ßos da VRAM, ent√£o suponho que o CRTC esteja mapeado nas portas de I/O 0x44 e 0x45
[2017-11-05 00:56:43] Felipe "Juca" Sanches: por conta disso escrevi o seguinte no driver:
[2017-11-05 00:56:50] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804730778_37572.jpg
[2017-11-05 00:57:13] Felipe "Juca" Sanches: Mas n√£o funcionou
[2017-11-05 01:03:52] Werner Eck: d√° uma olhada a partir da pg 17 desse ds
[2017-11-05 01:06:07] Werner Eck: tbm isso aqui √≥:
[2017-11-05 01:06:11] Werner Eck sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804729789_40008.jpg
[2017-11-05 01:06:15] Felipe "Juca" Sanches: Eu acho que o problema √© o seguinte: o CRTC requisite uma opera√ß√£o de DMA para ler o conte√∫do da VRAM. Quem recebe esse pedido √© o chip controlador de DMA, o Intel 8257. Ele vai fazer a m√°gica dele e sinalizar de volta pro CRTC quando tiver terminado.
[2017-11-05 01:07:17] Felipe "Juca" Sanches: ent√£o tem 3 coisas que meu driver de emula√ß√£o precisa fazer direito simultaneamente: (A) mapear o CRTC nas portas de I/O corretas para que ele possa ser configurado pela CPU. Isso acho que j√° consegui sacar, por que parece √≥bvio que as portas s√£o 0x44 e 0x45.
[2017-11-05 01:07:34] Werner Eck: sim, seria o DRQ/DACK
[2017-11-05 01:07:43] Felipe "Juca" Sanches: (B) mapear o chip controlador de DMA nas portas corretas (esse eu ainda n√£o fiz)
[2017-11-05 01:08:00] Felipe "Juca" Sanches: e (C) interconectar os 2 chips por meio dos dinais DRQ e DACk
[2017-11-05 01:08:27] Werner Eck: pode ser q o 5 nem esteja sendo ativado ainda
[2017-11-05 01:08:30] Felipe "Juca" Sanches: eu to tentando fazer (C), mas n√£o sei se estou fazendo direito. Mas n√£o adianta nada se eu n√£o fizer (B) tamb√©m.
[2017-11-05 01:08:48] Felipe "Juca" Sanches: 5 ?
[2017-11-05 01:09:07] Werner Eck: tentei editar e nao deixou
[2017-11-05 01:09:09] Werner Eck: 8275
[2017-11-05 01:09:15] Felipe "Juca" Sanches: ah ok
[2017-11-05 01:09:41] Werner Eck: parece q o telegram tem problema qdo o texto tem mais de uma linha
[2017-11-05 01:09:51] Werner Eck: pra editar, o cursor n√£o sobe
[2017-11-05 01:10:01] Felipe "Juca" Sanches: os n√∫meros dos chips s√£o muito parecidos. Um √© 8275 o outro √© 8257. √â pra dar n√≥ na cabe√ßa. Prefiro me referir a eles como CRTC (o 75) e DMAC (o 57)
[2017-11-05 01:10:10] Werner Eck: certo
[2017-11-05 01:10:44] Werner Eck: eu penso q talvez o crtc nem esteja sendo ativado, pois seria ele quem deveria ler aquela janela de ram e sincronizar o display cm o conteudo
[2017-11-05 01:11:07] Werner Eck: vc n√£o teria como visualizar o status dos pinos dele ?
[2017-11-05 01:11:16] Werner Eck: n√£o sei se isso √© poss√≠vel
[2017-11-05 01:11:17] Felipe "Juca" Sanches: olhando no c√≥digo de boot vejo outros 2 endere√ßos de I/O sendo usados, ent√£o s√≥ pode ser a configura√ß√£o do DMAC:
[2017-11-05 01:11:25] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804727843_37870.jpg
[2017-11-05 01:11:33] Felipe "Juca" Sanches: nos endere√ßos 0x30 e 0x31
[2017-11-05 01:11:44] Felipe "Juca" Sanches: vou tentar mapear o DMAC nessas duas portas e ver no que d√°
[2017-11-05 01:12:02] Werner Eck: vai la
[2017-11-05 01:13:08] Felipe "Juca" Sanches: ficou assim agora:
[2017-11-05 01:13:14] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804730481_38687.jpg
[2017-11-05 01:13:35] Werner Eck: rodou j√°?
[2017-11-05 01:14:24] Felipe "Juca" Sanches: compilando e tentando rodar
[2017-11-05 01:17:26] Felipe "Juca" Sanches: ent√£o... nada ainda.
[2017-11-05 01:17:49] Felipe "Juca" Sanches: Estou um pouco confuso sobre o mecanismo de interconex√£o dos sinais de DMA request e ACK
[2017-11-05 01:18:11] Werner Eck: existe no debugger algum jeito de vc monitorar certos sinais q v√£o pro crtc em tempo real?
[2017-11-05 01:18:15] Felipe "Juca" Sanches: o MAME oferece algumas macros que parecem sugerir que h√° tipos distintos de requisi√ß√µes, para IO ou acesso de mem√≥ria
[2017-11-05 01:18:31] Felipe "Juca" Sanches: e tamb√©m parece que tem mais de um sinal de requisi√ß√£o poss√≠vel para requisi√ß√£o
[2017-11-05 01:18:36] Werner Eck: q nem a gente estava fazendo com o PC, ACC do zezinho?
[2017-11-05 01:18:54] Felipe "Juca" Sanches: seria prudente agora eu ler o datasheet do DMAC pra entender o que significam os 4 bytes que o firmware escreveu na configura√ß√£o
[2017-11-05 01:19:05] Werner Eck: acredito q sim
[2017-11-05 01:19:26] Felipe "Juca" Sanches (in reply to Felipe "Juca" Sanches): Esses valores aqui
[2017-11-05 01:20:39] Felipe "Juca" Sanches: ent√£o √© esse cara que temos que estudar agora: http://www.threedee.com/jcm/terak/docs/Intel%208257%20Programmable%20DMA%20Controller.pdf
[2017-11-05 01:21:12] Werner Eck: talvez esses 4 valores q ele joga no &0x30 seja algum handshake
[2017-11-05 01:21:45] Felipe "Juca" Sanches: os 4 valores s√£o a inicializa√ß√£o do DMAC
[2017-11-05 01:22:16] Felipe "Juca" Sanches: eles devem especificar, por exemplo, as prioridades de tratamento dos pedidos de transferencia
[2017-11-05 01:24:06] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804729151_40381.jpg
[2017-11-05 01:24:19] Werner Eck: tava pra te mandar isso!
[2017-11-05 01:24:22] Werner Eck: exatamente isso
[2017-11-05 01:24:33] Felipe "Juca" Sanches: Essa descri√ß√£o do DMAC me faz acreditar que talvez os endere√ßos 0x8000 e 0x8FFF s√£o escritos no DMAC
[2017-11-05 01:24:36] Felipe "Juca" Sanches: e n√£o no CRTC
[2017-11-05 01:24:42] Werner Eck: dois registradores, um de endere√ßamento e outro de contagem
[2017-11-05 01:24:44] Felipe "Juca" Sanches: ent√£o vou inverter o mapeamento
[2017-11-05 01:25:15] Werner Eck: vc vai jogar o 8000 e 8fff no dma e o 30 e 31 no crtc?
[2017-11-05 01:25:16] Felipe "Juca" Sanches: por que aqueles valores dos endere√ßos 30 e 31 devem ser configura√ß√£o de resolu√ß√£o da tela e tamanho dos caracteres do CRTC
[2017-11-05 01:25:52] Werner Eck: de onde vc tirou isso?
[2017-11-05 01:26:30] Felipe "Juca" Sanches: vou trocar o mapeamento dos chips: botar DMAC nas portas de I/O 44 e 45 (que √© onde o firmware escreve 0x8000 e 0x8fff) e CRTC nas portas 30 e 31 (que √© onde ofw escreve aqueles outros valores)
[2017-11-05 01:26:37] Felipe "Juca" Sanches (in reply to Werner Eck): intui√ß√£o
[2017-11-05 01:26:42] Werner Eck: hahha
[2017-11-05 01:26:45] Werner Eck: entendi
[2017-11-05 01:27:03] Werner Eck (in reply to Felipe "Juca" Sanches): vdd
[2017-11-05 01:27:09] Werner Eck: tenta l√°
[2017-11-05 01:27:52] Felipe "Juca" Sanches: epa ! O bicho solu√ßou aqui hahaha
[2017-11-05 01:27:58] Werner Eck: opa!
[2017-11-05 01:28:02] Werner Eck: manda print ae
[2017-11-05 01:28:12] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804730735_38759.jpg
[2017-11-05 01:29:10] Werner Eck: umm, pode ser muita coisa
[2017-11-05 01:29:40] Werner Eck: pergunto ainda, se o crtc est√° sendo acionado corretamente
[2017-11-05 01:30:41] Felipe "Juca" Sanches: veja que o simbolo que se repete √© o s√≠mbolo n√∫mero zero
[2017-11-05 01:31:10] Felipe "Juca" Sanches (in reply to Felipe "Juca" Sanches): de acordo com essa visualiza√ß√£o dos tiles dispon√≠veis
[2017-11-05 01:31:47] Werner Eck: umm
[2017-11-05 01:32:33] Werner Eck: outra coisa, se o simbolo q aparece √© sempre repetido, ele tbm n√£o est√° incrementando o contador de caracteres
[2017-11-05 01:32:40] Werner Eck: √© o q parece
[2017-11-05 01:32:52] Felipe "Juca" Sanches: ou est√° lendo outra regi√£o da RAM
[2017-11-05 01:32:58] Felipe "Juca" Sanches: fora da faixa de VRAM
[2017-11-05 01:32:59] Werner Eck: ou isso
[2017-11-05 01:33:02] Felipe "Juca" Sanches: onde t√° tudo zero
[2017-11-05 01:33:10] Werner Eck: pode ser muita coisa
[2017-11-05 01:33:40] Werner Eck: suponhamos q eles dois estejam se falando direitinho agora, e a quest√£o seja mudar a janela
[2017-11-05 01:33:55] Werner Eck: seria o cen√°rio mais "f√°cil" de resolver
[2017-11-05 01:34:30] Werner Eck: mas eu novamente pergunto, como a gente sabe se ele est√° lendo a partir de outro endere√ßo qq?
[2017-11-05 01:34:42] Werner Eck: tem como visualizar isso no debugger?
[2017-11-05 01:35:01] Werner Eck: pq sen√£o vc vai ter q ir na tentativa e erro, mudando o valor do ender...
[2017-11-05 01:35:11] Werner Eck: vc mudou os valores que ele guardava nos registradores?
[2017-11-05 01:35:24] Werner Eck: vc inverteu os registradores dos dois chips
[2017-11-05 01:35:36] Werner Eck: e os valores 8000 e 8fff?
[2017-11-05 01:35:57] Felipe "Juca" Sanches: os valores 8000 e 8fff s√£o escritos no chip pelo firmware
[2017-11-05 01:36:01] Werner Eck: est√£o sendo armazenados em qual dos dois pares de registradores?
[2017-11-05 01:36:06] Felipe "Juca" Sanches: isso √© um fato. Nao tem que ser mudado
[2017-11-05 01:36:12] Werner Eck: t√°
[2017-11-05 01:36:23] Werner Eck: ent√£o...
[2017-11-05 01:36:51] Felipe "Juca" Sanches: vou voltar a ler o datasheet pra entender melhor o mecanismo de programa√ß√£o desses dois chips e interpretar os valores que o firmware escreve
[2017-11-05 01:37:05] Felipe "Juca" Sanches: por que o firmware est√° dizendo pra gente e a gente n√£o t√° querendo ler
[2017-11-05 01:37:31] Felipe "Juca" Sanches (in reply to Felipe "Juca" Sanches): a resposta est√° aqui. √â s√≥ interpretar o que significa com base no datasheet
[2017-11-05 01:38:28] Felipe "Juca" Sanches: E acabei de perceber que cortei errado essa imagem. Ficou faltando mostrar o primeiro valor que √© enviado para a porta 31
[2017-11-05 01:39:44] Felipe "Juca" Sanches: o valor √© zero, por que a instru√ß√£o logo antes de out 31 √© "XRA A" que, se n√£o me engano √© A <= A XOR A, que equivale a A=0
[2017-11-05 01:40:24] Werner Eck: eu to com uma suspeita
[2017-11-05 01:40:34] Felipe "Juca" Sanches: ent√£o a resposta tem que estar aqui:
[2017-11-05 01:40:39] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805514450_32069.jpg
[2017-11-05 01:41:00] Werner Eck: de q esses 4 valores jogados no &30 possam estar inicializando os 4 modos de dma
[2017-11-05 01:43:04] Werner Eck: poderia ser ou o crtc jogando DRQ0~DRQ3 pro dma ou o dma jogando dack0~dack3 pro crtc
[2017-11-05 01:43:13] Werner Eck: eu to meio confuso
[2017-11-05 01:44:03] Felipe "Juca" Sanches: n√£o... esses valores a√≠ s√£o a inicializa√ß√£o do CRTC
[2017-11-05 01:44:09] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804727691_39789.jpg
[2017-11-05 01:44:41] Felipe "Juca" Sanches: a primeira escrita √© em 0x31 (bit A0=1) e o valor √© zero, ou seja, trata-se desse comando a√≠ da tabela acima, o comando de reset do CRTC
[2017-11-05 01:45:00] Felipe "Juca" Sanches: e os 4 bytes seguintes s√£o escritos em 0x30 (bit A0=0)
[2017-11-05 01:45:30] Felipe "Juca" Sanches: ent√£o o primeiro byte √© 4F = 0100 1111 = S H H H H H H H
[2017-11-05 01:45:45] Felipe "Juca" Sanches: ent√£o S=0 e H = 4f
[2017-11-05 01:46:17] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804721546_82071.jpg
[2017-11-05 01:47:03] Felipe "Juca" Sanches: S=0 significa "Normal Rows" (isso provavelmente significa que n√£o h√° 1 ou mais pixels de espa√ßamento entre os tiles)
[2017-11-05 01:47:56] Felipe "Juca" Sanches: e H=4f significa que temos 0x50 caracteres por linha
[2017-11-05 01:48:03] Felipe "Juca" Sanches: veja que soma 1 ao valor
[2017-11-05 01:48:18] Felipe "Juca" Sanches: 0x50 = 80 caracteres por linha
[2017-11-05 01:48:52] Felipe "Juca" Sanches: oras bolas... √© um terminal de 80 colunas :-)
[2017-11-05 01:49:30] Felipe "Juca" Sanches: veja, inclusive, na tabela acima, que 80 √© o maior valor permitido.
[2017-11-05 01:49:46] Felipe "Juca" Sanches: e t√° l√° justamente o nosso 4F na tabela
[2017-11-05 01:49:51] Werner Eck: e 4f=79
[2017-11-05 01:50:02] Werner Eck: 0x4f = 79d
[2017-11-05 01:50:02] Felipe "Juca" Sanches: ele soma 1 sempre
[2017-11-05 01:50:30] Felipe "Juca" Sanches: o valor zero significa 1 caractere por coluna e assim por diante. Veja de novo os valores da tabela
[2017-11-05 01:51:00] Felipe "Juca" Sanches: o chip interpreta a configura√ß√£o como (valor+1)
[2017-11-05 01:52:34] Felipe "Juca" Sanches: o segundo byte √© 0x59 = V V R R R R R R
[2017-11-05 01:52:54] Felipe "Juca" Sanches: 0x59 = 0101 1001
[2017-11-05 01:53:16] Felipe "Juca" Sanches: V = 1 e R = 25
[2017-11-05 01:53:18] Werner Eck (in reply to Felipe "Juca" Sanches): vc quer dizer, 1 char por linha?
[2017-11-05 01:53:41] Werner Eck: to tentando ler essa parte
[2017-11-05 01:54:23] Felipe "Juca" Sanches (in reply to Felipe "Juca" Sanches): ok... vamos olhar para a tabela de novo
[2017-11-05 01:55:38] Felipe "Juca" Sanches: caso esse par√¢metro tivesse recebido uma escrita do valor 0x00 = 0 0 0 0 0 0 0 0 , isso significaria 1 char por linha (que √© bizarro, mas parece que o chip suporta esses casos degenerados)
[2017-11-05 01:56:04] Felipe "Juca" Sanches: isso provavelmente seria um caractere grand√£o, esticad√£o na horizontal
[2017-11-05 01:56:15] Felipe "Juca" Sanches: pra um √∫nico caractere ser desenhado em uma linha inteira
[2017-11-05 01:56:31] Felipe "Juca" Sanches: mas o que o firmware do sagitta configura √© 4F
[2017-11-05 01:57:06] Felipe "Juca" Sanches: que √© o valor bin√°rio 1 0 0 1 1 1 1, que, apesar de em decimal valer 79, na tabela ele mostra que o chip interpreta como sendo 80 chars por linha
[2017-11-05 01:57:18] Werner Eck: e os outros valores, $59, $99, $ee?
[2017-11-05 01:57:29] Felipe "Juca" Sanches: ok... vamos pros outros 3 valores
[2017-11-05 01:57:46] Felipe "Juca" Sanches: o segundo valor √© 0x59 = 0 1 0 1 1 0 0 1
[2017-11-05 01:58:30] Felipe "Juca" Sanches: que segundo a tabela corresponde aos valores dos par√¢metros V V R R R R R R
[2017-11-05 01:58:45] Felipe "Juca" Sanches: V = 1 e R = 25
[2017-11-05 01:59:00] Felipe "Juca" Sanches: e o significado desses valores:
[2017-11-05 01:59:05] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804722079_62639.jpg
[2017-11-05 01:59:22] Werner Eck: s√£o esses parametros V e R q eu n√£o estou achando
[2017-11-05 01:59:38] Werner Eck: √© q vc deve estar com esse pdf em v√°rias abas
[2017-11-05 01:59:46] Felipe "Juca" Sanches: R = rows / frame
[2017-11-05 02:00:33] Felipe "Juca" Sanches: t√° na parte debaixo da p√°gina 17 (que √© identificada como p√°gina 8-239)
[2017-11-05 02:01:02] Werner Eck: acabei de me dar conta de q t√° td ali na msm pag, eu q comi bola
[2017-11-05 02:01:54] Werner Eck: Eu quero pensar q essa parte de inicializa√ß√£o do CRTC esteja funcionando
[2017-11-05 02:02:07] Felipe "Juca" Sanches: yep
[2017-11-05 02:02:11] Felipe "Juca" Sanches: parece tudo perfeito
[2017-11-05 02:02:23] Felipe "Juca" Sanches: por que esse valor R = 25 √© o que nos diz que a tela tem 25 linhas
[2017-11-05 02:02:30] Felipe "Juca" Sanches: ou seja √© um terminal em resolu√ß√£o 80x25
[2017-11-05 02:02:37] Felipe "Juca" Sanches: resolu√ß√£o bem t√≠pica
[2017-11-05 02:02:43] Werner Eck: uma coisa q me chamou a aten√ß√£o √© esse parametro M
[2017-11-05 02:03:35] Werner Eck: parece ser um offset para o contador de linhas. Mas pensando melhor, acho q nao tem nada a ver com nada
[2017-11-05 02:03:43] Werner Eck: entao, voltamos ao estado de...
[2017-11-05 02:03:58] Werner Eck: parece q a inicializa√ß√£o do CRTC se d√° ali mesmo
[2017-11-05 02:04:22] Werner Eck: talvez ent√£o, ele n√£o esteja lendo a √°rea certa?
[2017-11-05 02:05:25] Werner Eck: ou os caracteres lidos n√£o estejam sendo escritos na √°rea de VRAM q o CRTC espera? Mas se isso est√° codificado na EPROM, ent√£o √© l√° mesmo q tem q ser
[2017-11-05 02:06:08] Werner Eck: ser√° q estamos setando o CRTC para o range de endere√ßamento de VRAM certo?
[2017-11-05 02:09:01] Felipe "Juca" Sanches: eu acho que a transfer√™ncia DMA n√£o est√° acontecendo
[2017-11-05 02:09:21] Felipe "Juca" Sanches: por que o emulador n√£o est√° interligando corretamente os sinais entre o DMAC e o CRTC
[2017-11-05 02:09:43] Felipe "Juca" Sanches: e o efeito colateral √© que o CRTC √© inicializado, mas sua mem√≥ria interna tem um buffer todo cheio de zeros
[2017-11-05 02:09:58] Felipe "Juca" Sanches: e ele nunca consegue efetuar uma leitura via DMA
[2017-11-05 02:10:10] Felipe "Juca" Sanches: e portanto a gente continua vendo o caractere n√∫mero zero na tela inteira
[2017-11-05 02:10:38] Felipe "Juca" Sanches: acho que o ponto agora √© estudar o mecanismo de requisi√ß√£o e acknowledge de transfer√™ncia DMA
[2017-11-05 02:11:26] Felipe "Juca" Sanches: o endere√ßo inicial e final tamb√©m devem estar sendo configurados corretamente, pois j√° mapeei o DMAC nas portas 44 e 45 que √© onde o firmware escreve 8000 e 8fff que √© a faixa de endere√ßos da VRAM
[2017-11-05 02:12:09] Felipe "Juca" Sanches: acho que j√° matamos a xarada do mapeamento em I/O e o n√≥ est√° agora na emula√ß√£o da interconex√£o dos 2 chips.
[2017-11-05 02:13:20] Felipe "Juca" Sanches: tem um outro carinha na jogada que √© o Intel 8212
[2017-11-05 02:13:46] Felipe "Juca" Sanches: tem um desses na placa e o datasheet do DMAC diz que ele √© projetado pra trabalhar junto com um 8212
[2017-11-05 02:13:51] Werner Eck: ele existe no sagitta?
[2017-11-05 02:13:54] Felipe "Juca" Sanches: sim
[2017-11-05 02:14:03] Werner Eck: eu tava vendo isso no ds do crt
[2017-11-05 02:14:57] Werner Eck: veja na pg 2-112
[2017-11-05 02:15:49] Werner Eck: e depois pg 2-111, fig 8
[2017-11-05 02:19:00] Werner Eck: e o 8212 √© um latch de 8 bits
[2017-11-05 02:19:30] Werner Eck: se vc disse q tem ele na placa, teria q emular o bicho tbm
[2017-11-05 02:19:53] Werner Eck: ele deve estar entre o barramento de dados e o crtc
[2017-11-05 02:36:48] Felipe "Juca" Sanches: A configura√ß√£o do DMAController √© meio confusa no MAME. Olha um exemplo de um driver de outro computador que usa esse chip. Olha como ficam as macros:
[2017-11-05 02:36:54] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804727670_38379.jpg
[2017-11-05 02:37:06] Felipe "Juca" Sanches: Tenho que entender melhor a fun√ß√£o de cada sinal
[2017-11-05 02:37:14] Felipe "Juca" Sanches: pra n√£o ficar perdido
[2017-11-05 02:37:30] Felipe "Juca" Sanches: n√£o adianta chutar. O importante √© entender o que est√° acontecendo :-)
[2017-11-05 02:37:41] Felipe "Juca" Sanches: Vou dormir. Amanh√£ eu devo continuar nessa pesquisa
[2017-11-05 02:38:10] Felipe "Juca" Sanches: em √∫ltima inst√¢ncia, d√° pra ir l√° na USP com um mult√≠metro e verificar quais s√£o as interliga√ß√µes que foram feitas entre os chips
[2017-11-05 02:38:24] Felipe "Juca" Sanches: boa noite!
[2017-11-05 02:39:09] Werner Eck: boa noite!
[2017-11-05 02:48:25] Felipe "Juca" Sanches: uma observa√ß√£o, entretanto...
[2017-11-05 02:49:38] Felipe "Juca" Sanches: apesar de vermos os endere√ßos de I/O 44 e 45 sendo usados, o chip DMAC provavelmente est√° mapeado nas portas de 0x40 at√© 0x48
[2017-11-05 02:50:03] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804726878_39715.jpg
[2017-11-05 02:50:26] Felipe "Juca" Sanches: e o acesso a 44 e 45 √© a configura√ß√£o do canal n√∫mero 2
[2017-11-05 02:50:52] Felipe "Juca" Sanches: e, de fato tem uma escrita que o firmware faz no endere√ßo 0x48
[2017-11-05 02:50:56] Felipe "Juca" Sanches: eu tava comendo bola
[2017-11-05 02:51:20] Felipe "Juca" Sanches: vou mapear nesse range, por que assim a escrita em 0x48 vai setar o modo de opera√ß√£o da DMA
[2017-11-05 02:51:24] Felipe "Juca" Sanches: caramba... acho que √© isso
[2017-11-05 02:51:33] Werner Eck: quer tentar?
[2017-11-05 02:52:01] Felipe "Juca" Sanches: estou tentando
[2017-11-05 02:53:23] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804724205_56977.jpg
[2017-11-05 02:53:30] Felipe "Juca" Sanches: olha a escrita em 0x48 al√≠
[2017-11-05 02:53:39] Felipe "Juca" Sanches: t√° escrevendo o valor 0xC4
[2017-11-05 02:53:47] Felipe "Juca" Sanches: vamos ver o que √© esse valor ?
[2017-11-05 02:54:38] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804729055_39275.jpg
[2017-11-05 02:54:59] Werner Eck: acabei de chegar nisso
[2017-11-05 02:55:25] Felipe "Juca" Sanches: o valor 4 do n√∫mero 0xC4 s√£o aqueles 4 bits baixos de enable dos canais
[2017-11-05 02:55:30] Felipe "Juca" Sanches: 4 = 0 1 0 0
[2017-11-05 02:55:37] Felipe "Juca" Sanches: ou seja, todos os canais est√£o desabilitados
[2017-11-05 02:55:42] Felipe "Juca" Sanches: exceto o canal n√∫mero 2
[2017-11-05 02:55:43] Werner Eck: c4=11000100
[2017-11-05 02:56:46] Felipe "Juca" Sanches: isso √© a prova de que o sinal de DMA Request que o chip CRTC precisa enviar para o DMAC √© por meio do canal 2.
[2017-11-05 02:58:52] Felipe "Juca" Sanches: √â por isso que eu estou mantendo essa linha assim:
[2017-11-05 02:58:59] Felipe "Juca" Sanches sent document: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_5184080467493650480.png
[2017-11-05 02:59:33] Felipe "Juca" Sanches: MCFG_I8275_DRQ_CALLBACK(DEVWRITELINE("dma8257" , i8257_device , dreq2_w))
[2017-11-05 02:59:33] Werner Eck: dreq2
[2017-11-05 02:59:46] Werner Eck: write
[2017-11-05 03:00:37] Felipe "Juca" Sanches: dreq2_w √© o m√©todo do emulador do DMAC que voc√ä precisa chamar para sinalizar uma requisi√ß√£o de DMA para o canal #2
[2017-11-05 03:00:51] Werner Eck: entendi
[2017-11-05 03:00:58] Werner Eck: imaginei q seria isso
[2017-11-05 03:01:37] Felipe "Juca" Sanches: veja que essa macro configura que o DRQ emitido pelo CRTC chama um callback que sinaliza um dma request no canal 2 do DMAC
[2017-11-05 03:02:14] Felipe "Juca" Sanches: levou um tempinho at√© eu entender essa sintaxe
[2017-11-05 03:05:37] Werner Eck: agora sabemos q ele est√° setando o modo dma no canal 2, para isso o CRTC precisa requisitar nesse canal
[2017-11-05 03:05:46] Felipe "Juca" Sanches: sim
[2017-11-05 03:05:49] Felipe "Juca" Sanches: n√£o t√° funcionando ainda, mas foi bom eu ter tido essa sacada
[2017-11-05 03:06:09] Felipe "Juca" Sanches: se eu continuasse mapeando em 44 e 45 apenas, jamais iria funcionar
[2017-11-05 03:06:26] Felipe "Juca" Sanches: precisa mapear no intervalo todo, pra que o firmware consiga configurar o chip de DMA
[2017-11-05 03:06:30] Felipe "Juca" Sanches: na porta 48
[2017-11-05 03:07:02] Werner Eck: vdd
[2017-11-05 03:07:11] Werner Eck: bom, eu realmente preciso descansar
[2017-11-05 03:07:21] Werner Eck: j√° to vendo n√©voa na minha frente
[2017-11-05 03:07:38] Werner Eck: boa noite, vou nessa.
[2017-11-05 03:07:48] Felipe "Juca" Sanches: tem uns outros bandidos que s√£o as portas 0x21, 0x00 e 0x50
[2017-11-05 03:08:05] Felipe "Juca" Sanches: o firmware acessa esses outros endere√ßos logo no come√ßo
[2017-11-05 03:08:09] Felipe "Juca" Sanches: ent√£o a√≠ tem coisa tamb√©m
[2017-11-05 03:08:19] Felipe "Juca" Sanches: talvez seja o setup do chip de RS232
[2017-11-05 03:08:30] Werner Eck: amanh√£ podemos ver isso
[2017-11-05 03:08:38] Felipe "Juca" Sanches: beleza
[2017-11-05 03:08:45] Werner Eck: üëç
[2017-11-05 03:09:04] Felipe "Juca" Sanches: eu posso tamb√©m em algum momento dar um commit e subir pro meu github esse c√≥digo atual do driver pela metade
[2017-11-05 03:09:42] Felipe "Juca" Sanches: boa noite
[2017-11-05 03:09:43] Felipe "Juca" Sanches: e happy hacking!
[2017-11-05 03:44:56] Felipe "Juca" Sanches: BOOOM !!!!
[2017-11-05 03:45:02] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804724025_59408.jpg
[2017-11-05 03:52:11] Felipe "Juca" Sanches: https://github.com/mamedev/mame/pull/2776
[2017-11-05 03:52:23] Felipe "Juca" Sanches: Agora sim! Agora posso ir dormir :-)
[2017-11-05 10:40:46] Felipe "Juca" Sanches: http://www.linusakesson.net/programming/tty/
[2017-11-05 11:47:35] Werner Eck: Eae maluco?!!
[2017-11-05 11:47:43] Werner Eck: Fala, o q era?
[2017-11-05 11:53:41] Felipe "Juca" Sanches: hehe
[2017-11-05 11:53:49] Felipe "Juca" Sanches: burocracias do MAME
[2017-11-05 11:54:04] Werner Eck: jura??
[2017-11-05 11:54:12] Werner Eck: to olhando l√° o seu commit
[2017-11-05 11:54:16] Felipe "Juca" Sanches: tinha faltado eu implementar explicitamente o mecanismo de leitura de mem√≥ria
[2017-11-05 11:54:27] Werner Eck: putaqueospa
[2017-11-05 11:54:34] Felipe "Juca" Sanches: pra ser sincero... eu n√£o entendi direito tudo ainda
[2017-11-05 11:54:38] Werner Eck: n√£o era nada t√©cnico no final das contas
[2017-11-05 11:54:54] Felipe "Juca" Sanches: mais ou menos...
[2017-11-05 11:55:02] Werner Eck: me fala, os endere√ßos dos registradores de dma e do crtc estavam certos no fim?
[2017-11-05 11:55:08] Felipe "Juca" Sanches: sim
[2017-11-05 11:55:23] Felipe "Juca" Sanches: agora o pr√≥ximo passo √© fazer a serial funcionar
[2017-11-05 11:55:44] Werner Eck: tem q emular o uart
[2017-11-05 11:55:47] Felipe "Juca" Sanches: suspeito que o controlador de porta serial esteja mapeado no endere√ßo 0x21
[2017-11-05 11:56:02] Felipe "Juca" Sanches: j√° instanciei o m√≥dulo de emula√ß√£o de UART
[2017-11-05 11:56:03] Werner Eck: se j√° tiver ele no MAME, meio caminho andado...
[2017-11-05 11:56:07] Felipe "Juca" Sanches: falta configurar
[2017-11-05 11:56:11] Felipe "Juca" Sanches: sim, j√° tem
[2017-11-05 11:56:16] Felipe "Juca" Sanches: essas coisas s√£o muito comuns
[2017-11-05 11:56:31] Felipe "Juca" Sanches: o MAME √© extremamente modular e certamente algum outro driver j√° usou esses chips todos
[2017-11-05 11:56:34] Werner Eck: da√≠ √© pegar no ds pra saber como √© a inicializa√ß√£o n√©? E comparar padr√µes na EPROM pra encontrar isso
[2017-11-05 11:56:45] Felipe "Juca" Sanches: √©
[2017-11-05 11:56:48] Felipe "Juca" Sanches: √© por a√≠
[2017-11-05 11:57:04] Werner Eck: vc j√° desconfia de onde tenha isso na EPROM?
[2017-11-05 11:57:08] Werner Eck: de tanto olhar
[2017-11-05 11:57:51] Felipe "Juca" Sanches: estou suspeitando desse c√≥digo aqui:
[2017-11-05 11:57:56] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804728373_38609.jpg
[2017-11-05 11:58:09] Felipe "Juca" Sanches: portas 0x21 e 0x00
[2017-11-05 11:59:04] Werner Eck: parece ser bem semelhante ao dma... ele joga 3 valores na $21
[2017-11-05 11:59:16] Werner Eck: deve estar setando alguns modos
[2017-11-05 11:59:39] Werner Eck: √© o q lembra, daquilo q vimos ontem. Qual o c√≥digo do chip SPI?
[2017-11-05 12:01:00] Werner Eck: 8251?
[2017-11-05 12:02:32] Werner Eck: Isso aqui √© interessante ter como referencia: https://en.wikichip.org/wiki/intel/mcs-80
[2017-11-05 12:06:44] Werner Eck: cara, ontem eu vi isso aqui, achei deveras interessante s√≥ q acabei n√£o postando: https://www.ebay.com/itm/Cray-2-Memory-Board-w-Lucite-Certificate-1985-SuperComputer-Module/111930874500?_trkparms=aid%3D111001%26algo%3DREC.SEED%26ao%3D1%26asc%3D20160727114228%26meid%3Dd5e5bcf895b443499abcbe358a3a491e%26pid%3D100290%26rk%3D3%26rkt%3D4%26sd%3D202076573924&_trksid=p2060778.c100290.m3507
[2017-11-05 12:21:31] Felipe "Juca" Sanches (forwarded from Fractal) sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805513861_31392.jpg
[2017-11-05 12:21:31] Felipe "Juca" Sanches (forwarded from Fractal) sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804728184_40283.jpg
[2017-11-05 12:27:15] Werner Eck sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804723432_59464.jpg
[2017-11-05 12:28:13] Werner Eck sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804725211_59181.jpg
[2017-11-05 12:29:24] Werner Eck sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804728269_38935.jpg
[2017-11-05 12:30:40] Werner Eck sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804728655_39173.jpg
[2017-11-05 13:03:30] Werner Eck: Se o 8251 for mapeado em $21, ent√£o a primeira palavra seta o modo ass√≠ncrono: 0x7A=01 11 10 10: 1 stop bit; paridade: habilitada, par; compr. palavra: 7 bits; fator baud rate: 16x
[2017-11-05 13:05:19] Werner Eck: O q segue deve ser a instru√ß√£o de comando seguida de dados. To lendo essa parte para entender
[2017-11-05 13:06:22] Felipe "Juca" Sanches: acho q √© mapeado em 0x20 e 0x21
[2017-11-05 13:07:57] Werner Eck: dois endere√ßos?
[2017-11-05 13:08:04] Felipe "Juca" Sanches: sim
[2017-11-05 13:08:44] Felipe "Juca" Sanches: um pra dados e outro pra comandos
[2017-11-05 13:08:51] Felipe "Juca" Sanches: √© um setup comum de v√°rios dispositivos
[2017-11-05 13:09:01] Felipe "Juca" Sanches: usar o bit de endere√ßo zero para diferenciar entre duas portas
[2017-11-05 13:09:23] Werner Eck: isso √© padr√£o do MAME?
[2017-11-05 13:09:27] Felipe "Juca" Sanches: n√£o
[2017-11-05 13:09:33] Felipe "Juca" Sanches: isso √© padr√£o de design de hardware
[2017-11-05 13:09:53] Werner Eck: q estranho... n√£o me soa familiar isso\
[2017-11-05 13:10:24] Werner Eck: Se quero endere√ßar um perif√©rico, uso um endere√ßo, no qual ele est√° mapeado...
[2017-11-05 13:10:49] Felipe "Juca" Sanches: muitos perif√©ricos usam multiplos endere√ßos
[2017-11-05 13:10:52] Felipe "Juca" Sanches: √© comum isso
[2017-11-05 13:11:28] Werner Eck: bom. vc acha q faz algum sentido o q eu falei a√≠ atr√°s?
[2017-11-05 13:12:00] Felipe "Juca" Sanches: acho que faz um pouco
[2017-11-05 13:12:08] Felipe "Juca" Sanches: mas n√£o acho que seja na porta 21
[2017-11-05 13:12:21] Felipe "Juca" Sanches: acho que ele est√° mapeando dados na 20 e comandos na 21
[2017-11-05 13:13:08] Werner Eck (in reply to Felipe "Juca" Sanches): √© q eu estava baseando a minha an√°lise nisso q vc falou
[2017-11-05 13:13:32] Werner Eck sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804723228_60349.jpg
[2017-11-05 13:13:59] Werner Eck: s√≥ vejo ele escrever no $21 nesse snippet. E le alguma coisa do $00
[2017-11-05 13:14:16] Felipe "Juca" Sanches: talvez n√£o haja escrita de dados nessa parte do programa, mas haja em outro trecho
[2017-11-05 13:14:16] Werner Eck: depois faz uns rotate right
[2017-11-05 13:15:00] Werner Eck: entendi
[2017-11-05 13:15:38] Werner Eck: bom, vou deixar pra qdo vc chegar nessa parte. A√≠ vc j√° tem condi√ß√£o de ver os mnem√¥nicos./
[2017-11-05 13:15:44] Felipe "Juca" Sanches: putz! acho que esse 0x00 pode ser o dipswitch !
[2017-11-05 13:15:49] Werner Eck: ummm.
[2017-11-05 13:16:09] Werner Eck: teria q ter os dispositivos mapeados
[2017-11-05 13:16:23] Werner Eck: pra saber em qual endere√ßo de mem√≥ria est√° cada um deles
[2017-11-05 13:17:36] Werner Eck: ele le o $00 e depois faz um AND com o q tem no acc
[2017-11-05 13:18:42] Werner Eck: minto; ele l√™ o $00 e depois faz um and com o q tiver no $03 e o acc
[2017-11-05 13:24:58] Werner Eck: na pr√°tica, entendo q ele joga o q tem no $00 no acc, depois faz um AND com esse valor e $03
[2017-11-05 13:27:33] Felipe "Juca" Sanches: isso
[2017-11-05 13:27:54] Felipe "Juca" Sanches: ele t√° tomando decis√£o em fun√ß√£o dos 2 bits menos significativos lidos da porta 0x00
[2017-11-05 13:27:58] Werner Eck: beleza; s√≥ falta entender o contexto disso
[2017-11-05 13:28:13] Felipe "Juca" Sanches: que eu acho que √© de onde ele l√™ a configura√ß√£o dos dipswiches
[2017-11-05 13:31:52] Werner Eck: pode ser sim. Um jeito comum de se deixar a parte de configura√ß√£o (stop bit, paridade, palavra, etc) da interface configur√°vel pelo usu√°rio
[2017-11-05 13:32:02] Werner Eck: se √© q isso √© a parte do 8251
[2017-11-05 13:32:11] Werner Eck: n√£o temos certeza ainda
[2017-11-05 13:32:28] Werner Eck: pode ser outra coisa
[2017-11-05 13:45:14] Felipe "Juca" Sanches: aqueles 2 bits lidos do endere√ßo 0x00 definem qual valor √© escrito na porta 0x21
[2017-11-05 13:45:19] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805514943_32308.jpg
[2017-11-05 13:45:48] Felipe "Juca" Sanches: 0x7A, 0x4E ou 0x5A
[2017-11-05 13:46:15] Werner Eck: ummmm... t√° fazendo mais sentido hein??
[2017-11-05 13:46:21] Felipe "Juca" Sanches: supondo que a porta 0x20 √© para dados e a 0x21 √© para comandos, acho que a gente pode tentar interpretar esses 3 valores conforme o datasheet descreve a estrutura dos comandos
[2017-11-05 13:46:31] Werner Eck: o modo
[2017-11-05 13:46:32] Felipe "Juca" Sanches: pra ver quais s√£o as op√ß√µes
[2017-11-05 13:46:40] Felipe "Juca" Sanches: e se fizer sentido, a gente documenta j√° no driver
[2017-11-05 13:46:53] Werner Eck: pode ser sincrono ou assincrono. E o terceiro byte pode ser o comando
[2017-11-05 13:47:36] Werner Eck: perae q eu preciso forrar o estomago. Senao caio duro aqui
[2017-11-05 13:47:53] Felipe "Juca" Sanches: olha s√≥ como se faz pra implementar um dip switch no MAME:
[2017-11-05 13:48:01] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805514962_32110.jpg
[2017-11-05 13:49:38] Werner Eck: ummm
[2017-11-05 13:49:46] Werner Eck: isso vc tirou de um driver j√° implementado?
[2017-11-05 13:50:00] Werner Eck: ou vc escreveu isso agora?
[2017-11-05 13:51:25] Werner Eck: üçõ
[2017-11-05 14:42:43] Werner Eck: Eu suponho q o q tem nas linhas 0x3A/0x3E/0x42 n√£o est√° sendo executado antes da instru√ß√£o da linha 0x46?
[2017-11-05 14:43:12] Werner Eck: talvez esse bloco q vc me passou seja parte de um desvio condicional?
[2017-11-05 14:43:44] Werner Eck: a l√≥gica estando mais concentrada nas linhas 0x57 e 0x5c?
[2017-11-05 14:43:52] Werner Eck: (q eu n√£o tenho)
[2017-11-05 16:34:50] Felipe "Juca" Sanches: segue ent√£o uma imagem mais completa do c√≥digo pra dar mais contexto:
[2017-11-05 16:34:59] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804727803_40690.jpg
[2017-11-05 16:35:36] Felipe "Juca" Sanches (in reply to Werner Eck): Esse c√≥digo a√≠ eu escrevi com base nas observa√ß√µes e conclus√µes que descrevi ontem/hoje aqui
[2017-11-05 16:36:12] Felipe "Juca" Sanches (in reply to Felipe "Juca" Sanches): √â claro que o tempo todo eu olho pra c√≥digo de outros drivers para aprender como se faz e para escrever de forma similar.
[2017-11-05 16:38:20] Werner Eck: poutz... desculpa parecer chato, mas esse ps a√≠ √© ileg√≠vel... üòî
[2017-11-05 16:38:42] Felipe "Juca" Sanches: clica na imagem pra ver maior
[2017-11-05 16:38:48] Werner Eck: ent√£o....
[2017-11-05 16:39:19] Werner Eck: eu at√© abri numa janela do browser, mas fica min√∫sculo mesmo assim. Dando zoom fica pixelado
[2017-11-05 16:39:34] Felipe "Juca" Sanches: eita!
[2017-11-05 16:40:51] Felipe "Juca" Sanches: vamos focar mais ent√£o:
[2017-11-05 16:40:56] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805514418_32427.jpg
[2017-11-05 16:41:55] Felipe "Juca" Sanches: s√£o 5 opera√ß√µes de escrita na porta $21
[2017-11-05 16:42:41] Felipe "Juca" Sanches: os bytes s√£o escritos nessa sequencia: 7A, 37, 40, X, 37
[2017-11-05 16:43:32] Felipe "Juca" Sanches: onde X √© um de 3 valores poss√≠veis (escolhidos em fun√ß√£o dos bits lidos da porta $00 - dispwitch?): 7a, 4e ou 5a
[2017-11-05 16:44:27] Felipe "Juca" Sanches: vou agora olhar pro datasheet do chip de UART pra ver o que esses comandos significam
[2017-11-05 16:45:09] Felipe "Juca" Sanches: http://pdf.datasheetcatalog.com/datasheet/Intel/mXtyswx.pdf
[2017-11-05 16:45:53] Werner Eck: ah, ent√£o o 7A/37/40 s√£o escritos sequencialmente na porta, s√≥ os 7a/4e/5a √© q s√£o selecion√°veis nas dips?
[2017-11-05 16:46:32] Felipe "Juca" Sanches: isso!
[2017-11-05 16:46:36] Werner Eck: na verdade, s√≥ os dois √∫ltimos...
[2017-11-05 16:46:43] Werner Eck: perceba como o 7a se repete
[2017-11-05 16:46:45] Werner Eck: √© o modo
[2017-11-05 16:46:49] Werner Eck: tenho certeza disso...
[2017-11-05 16:46:58] Werner Eck: o 7a √© sempre escrito
[2017-11-05 16:47:10] Felipe "Juca" Sanches: o primeiro byte √© 74
[2017-11-05 16:47:26] Werner Eck: onde vc viu isso?
[2017-11-05 16:47:31] Felipe "Juca" Sanches: ah nao
[2017-11-05 16:47:34] Felipe "Juca" Sanches: √© 7a mesmo
[2017-11-05 16:47:36] Felipe "Juca" Sanches: mal...
[2017-11-05 16:47:40] Werner Eck: ent√£o...
[2017-11-05 16:48:43] Felipe "Juca" Sanches: ent√£o... reiterando: os bytes s√£o escritos nessa sequencia: 7A, 37, 40, X, 37 (com X = 7a, 4e ou 5a)
[2017-11-05 16:51:17] Werner Eck: mas eu n√£o vejo nenhuma instru√ß√£o de branch direcionando para a linha 0x52.
[2017-11-05 16:51:54] Werner Eck: s√≥ para as linhas 0x57 e 0x5c
[2017-11-05 16:52:07] Werner Eck: caso ele n√£o fa√ßa jump para essas linhas, ele executa a 52
[2017-11-05 16:52:10] Werner Eck: correto?
[2017-11-05 16:52:45] Werner Eck: aaah
[2017-11-05 16:52:48] Werner Eck: aaaaaaaah
[2017-11-05 16:53:12] Werner Eck: √© isso. Ele le as dips, se der algum setting l√° ele executa o branch correspondente
[2017-11-05 16:53:30] Werner Eck: se n√£o der nada (0x00) ent√£o ele faz 0x7A e sai fora
[2017-11-05 16:54:31] Werner Eck: e a√≠ escreve 0x37 e na sequencia, l√™ da porta 0x50 - isso independente do q ele decidiu escrever anteriormente.
[2017-11-05 16:55:17] Felipe "Juca" Sanches: exato
[2017-11-05 16:55:23] Felipe "Juca" Sanches: a ultima escrita acontece em todos os casos
[2017-11-05 16:55:30] Felipe "Juca" Sanches: por que todas as condi√ß√µes pulam pra l√°
[2017-11-05 16:55:41] Felipe "Juca" Sanches: ent√£o apenas o quarto byte √© condicional
[2017-11-05 16:56:04] Werner Eck: e vc j√° decodificou os parametros q ele seta nos valores 4e e 5a?
[2017-11-05 16:56:26] Felipe "Juca" Sanches: ainda n√£o
[2017-11-05 16:56:32] Felipe "Juca" Sanches: estou vendo isso agora.
[2017-11-05 16:56:39] Felipe "Juca" Sanches: isso aqui √© importante:
[2017-11-05 16:56:44] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804726686_38622.jpg
[2017-11-05 16:57:24] Werner Eck: isso q eu tinha postado
[2017-11-05 16:57:44] Felipe "Juca" Sanches: ou seja, o primeiro byte, $7A, √© com certeza uma "mode instruction"
[2017-11-05 16:58:22] Felipe "Juca" Sanches: o outro 7A talvez seja uma "command instruction" e a√≠ pode ter uma interpreta√ß√£o diferente, apesar de ser o mesmo valor num√©rico
[2017-11-05 16:58:23] Werner Eck (in reply to Werner Eck): 7A seria isso
[2017-11-05 16:58:38] Werner Eck: n√£o 74...
[2017-11-05 16:58:52] Werner Eck: figuras 8 e 10
[2017-11-05 16:59:19] Felipe "Juca" Sanches: meu c√©rebro d√° n√≥ nesses n√∫meros... editei as mensagens anteriores para ficarem com o n√∫mero certo
[2017-11-05 16:59:32] Felipe "Juca" Sanches: sim, vc tem raz√£o √© 7A
[2017-11-05 16:59:39] Werner Eck: o q vc disse vai de encontro ao q eu falei tbm
[2017-11-05 17:00:01] Werner Eck: e t√° bem a√≠ nessa se√ß√£o q vc est√° lendo, uma ou duas p√°ginas adiante
[2017-11-05 17:00:19] Werner Eck: os detalhes de cada bit dependendo de como vc quer setar o modo
[2017-11-05 17:00:50] Felipe "Juca" Sanches: perfeito
[2017-11-05 17:00:57] Felipe "Juca" Sanches: acho que sua an√°lise est√° perfeita
[2017-11-05 17:01:46] Werner Eck: eu to devagar, pegando novamente o jeito
[2017-11-05 17:02:01] Werner Eck: nunca escrevi assembler do mcs-80
[2017-11-05 17:02:08] Felipe "Juca" Sanches: (eu tirei umas duas horas de cochilo durante a tarde hoje e j√° n√£o lembrava mais de nada :-D)
[2017-11-05 17:02:09] Werner Eck: mas escrevi do z-80
[2017-11-05 17:02:25] Werner Eck: e isso j√° faz 23 anos... rs
[2017-11-05 17:02:50] Felipe "Juca" Sanches: (n√£o lembrava mais dos coment√°rios que voc√™ tinha feito mais cedo hoje √† uma da tarde)
[2017-11-05 17:03:02] Werner Eck: n√£o esquenta Juca
[2017-11-05 17:03:08] Werner Eck: Tamo junto nesse projeto
[2017-11-05 17:03:13] Felipe "Juca" Sanches: claro
[2017-11-05 17:03:20] Werner Eck: (na medida em q eu ajudar mais e atrapalhar menos)
[2017-11-05 17:03:27] Felipe "Juca" Sanches: √© que eu vi que eu to explicando o que voc√™ j√° explicou hahahahah
[2017-11-05 17:03:47] Werner Eck: üòÜ
[2017-11-05 17:05:48] Felipe "Juca" Sanches: sabe aquele lance que eu te falei sobre tipicamente ser usado o bit A0 do barramento de endere√ßos para chavear entre duas portas  de I/O dos perif√©ricos ? Por exemplo portas 0x20 para dados e 0x21 para comandos
[2017-11-05 17:06:50] Felipe "Juca" Sanches: Na pr√°tica √© implementado usando esse sinal C ou /D:
[2017-11-05 17:07:01] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804726161_38565.jpg
[2017-11-05 17:07:44] Felipe "Juca" Sanches: o sinal A0 da CPU √© ligado a esse seletor Control/Data
[2017-11-05 17:08:18] Felipe "Juca" Sanches: Vou sair agora e volto daqui 1 hora. T√© mais
[2017-11-05 17:10:24] Felipe "Juca" Sanches: mas fica uma observa√ß√£o:
[2017-11-05 17:10:42] Felipe "Juca" Sanches: acho que s√≥ deve ter sobrado a porta de I/O 0x50 sendo manipulada pelo firmware
[2017-11-05 17:10:44] Felipe "Juca" Sanches: e n√£o sei ainda o que ela √©
[2017-11-05 17:12:03] Felipe "Juca" Sanches: ent√£o suspeito que possa ser relacionada √† leitura do teclado talvez. Algu√©m tem que fazer isso em algum momento. S√≥ n√£o sei se √© t√£o cedo no setup ou se √≥s vai ser feita a varredura do teclado mais pra frente
[2017-11-05 17:12:13] Felipe "Juca" Sanches: t√© mais
[2017-11-05 17:13:07] Werner Eck: üëç
[2017-11-05 17:17:01] Werner Eck: Eu imagino q o teclado seja constantemente lido
[2017-11-05 17:18:15] Werner Eck: Da√≠, se ele estiver mapeado no &0x50, provavelmente ele deve aparecer em algum momento dentro de um loop.
[2017-11-05 18:07:54] Felipe "Juca" Sanches: pode ser lido em rotina de interrup√ß√£o tamb√©m
[2017-11-05 18:08:13] Werner Eck: ISR, sim...
[2017-11-05 18:08:18] Werner Eck: bem lembrado
[2017-11-05 18:08:47] Werner Eck: da√≠ √© s√≥ ver nos endere√ßos espec√≠ficos q o processador olha...
[2017-11-05 18:27:58] Felipe "Juca" Sanches: eu mapeei o chip I8251 nas portas 0x20 e 0x21 e declarei que o hardware possui uma porta serial e que os sinais da porta est√£o ligados ao chip 8251:
[2017-11-05 18:28:07] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804728221_38603.jpg
[2017-11-05 18:29:59] Felipe "Juca" Sanches: E aquela linha MCFG_RS232_PORT_ADD("rs232", default_rs232_devices, nullptr) significa que √© uma porta onde os dispositivos seriais t√≠picos podem ser ligados ( default_rs232_devices √© uma lista de perif√©ricos seriais) e que por padr√£o o driver √© inicializado sem nenhum perif√©rico conectado nesa porta (por isso o nullptr ali)
[2017-11-05 18:33:01] Felipe "Juca" Sanches: com isso, aparece no menu interno da interface do MAME uma op√ß√£o para configurar a porta serial:
[2017-11-05 18:33:13] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804730747_39073.jpg
[2017-11-05 18:33:27] Felipe "Juca" Sanches: No submetu "Slot Devices" tem rs232
[2017-11-05 18:33:37] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804730289_38251.jpg
[2017-11-05 18:34:05] Felipe "Juca" Sanches: e veja que est√° inicialmente sem nenhum perif√©rico instalado na porta
[2017-11-05 18:35:02] Felipe "Juca" Sanches: mas posso selecionar algumas op√ß√µes como "printer", "null_modem", "pty", "keyboard", "loopback", "terminal"
[2017-11-05 18:35:20] Werner Eck: Seria como dizer, o terminal seria inicializado por padr√£o sem nenhum perif√©rico plugado na interface serial
[2017-11-05 18:35:51] Felipe "Juca" Sanches: dessas, a op√£√ßo "pty" √© interessante pois supostamente permitiria criar um par mestre/escravo de pseudo terminais do unix
[2017-11-05 18:35:58] Werner Eck: E vc seleciona um perif√©rico pelo MAME
[2017-11-05 18:36:39] Felipe "Juca" Sanches: e com isso talvez seja poss√≠vel eu configurar meu sistema hospedeito (GNU+Linux) para abrir uma sess√£o de login no terminal emulado e forma similar ao que acontece com programas emuladores de terminal vt-100 como o xterm ou o gnome-terminal
[2017-11-05 18:36:42] Werner Eck: Existe dentro dessas op√ß√µes, alguma q permita mapear a pr√≥pria serial do host rodando MAME como perif√©rico virtual?
[2017-11-05 18:37:10] Werner Eck: da√≠ permitindo conectar um dispositivo real via serial ao emulador?
[2017-11-05 18:37:33] Felipe "Juca" Sanches: hmmm... isso seria interessante tamb√©m
[2017-11-05 18:38:28] Felipe "Juca" Sanches: mas o que eu tenho em mente √© fazer tudo virtual: processos do meu GNU+Linux vinculados a um pseudo-terminal criado pelo MAME com a interface rs232 emulada do terminal da scopus
[2017-11-05 18:39:05] Werner Eck: E essa nossa implementa√ß√£o da rs232 est√° pronta?
[2017-11-05 18:39:24] Werner Eck: digo, no terminal Sagitta
[2017-11-05 18:40:16] Felipe "Juca" Sanches: eu n√£o sei como se configura um pseudo-terminal para abrir uma sess√£o de login no GNU+Linux, et√£o esse caminho via pty eu vou deixar pra investigar depois.
[2017-11-05 18:40:21] Felipe "Juca" Sanches: antes disso, testei outra coisa:
[2017-11-05 18:40:35] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804721868_82715.jpg
[2017-11-05 18:41:04] Felipe "Juca" Sanches: essa op√ß√£o instancia um terminal serial gen√©rico e liga ele na porta do sagitta emulado
[2017-11-05 18:41:19] Werner Eck: e na outra ponta o q vc obt√©m?
[2017-11-05 18:41:25] Felipe "Juca" Sanches: ao resetar, aparece isso aqui:
[2017-11-05 18:42:20] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804726007_39842.jpg
[2017-11-05 18:42:41] Felipe "Juca" Sanches: veja que a metade da janela do lado esquerdo √© a tela de um terminal gen√©rico
[2017-11-05 18:42:53] Felipe "Juca" Sanches: e o lado direito √© a tela do sagitta emulado
[2017-11-05 18:42:54] Werner Eck: ah ta.
[2017-11-05 18:42:58] Werner Eck: certo
[2017-11-05 18:43:21] Felipe "Juca" Sanches: a√≠ supostamente eu poderia digitar em um e ver os caracteres aparecendo no outro
[2017-11-05 18:43:22] Werner Eck: (t√° borrado, mas d√° pra ver esquerda vs direita)
[2017-11-05 18:43:33] Werner Eck: supostamente ou realmente? rss
[2017-11-05 18:43:42] Felipe "Juca" Sanches: quando eu digito n√£o acontece nada
[2017-11-05 18:43:59] Felipe "Juca" Sanches: mas o MAME tem um submenu para configura√ß√£o do terminal gen√©rico
[2017-11-05 18:44:02] Felipe "Juca" Sanches: veja aqui:
[2017-11-05 18:44:02] Werner Eck: vc implementou as dips?
[2017-11-05 18:44:24] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804725585_59269.jpg
[2017-11-05 18:44:51] Felipe "Juca" Sanches: declarei os dipswitches com valor default 0 nos dois bits
[2017-11-05 18:44:53] Werner Eck: cara eu acho q tem q ser 7 data bits, parity enabled, 1bit
[2017-11-05 18:45:07] Werner Eck: por causa daquele byte 0x7a
[2017-11-05 18:45:23] Werner Eck: suponho q ele esteja default nisso
[2017-11-05 18:45:28] Felipe "Juca" Sanches: ent√£o eu liguei o Local echo e pelo menos o terminal gen√©rico mostra o que eu to digitando nele
[2017-11-05 18:46:18] Felipe "Juca" Sanches: e agora preciso fazer isso que voc√™ t√° falando mesmo: configurar o terminal gen√©rico com os mesmos ajustes do terminal sagitta emulado pra ver se a emula√ß√£o est√° funcionando
[2017-11-05 18:46:31] Werner Eck: quanto √† taxa de transmiss√£o, estou incerto, pois no DS do chip ele explica q fica setado em "16x"
[2017-11-05 18:46:38] Werner Eck: vai l√°
[2017-11-05 18:48:14] Werner Eck: vc provavelmente tbm ter√° q experimentar com diversos baud rates diferentes.
[2017-11-05 18:48:32] Werner Eck: eu come√ßaria pelo mais baixo... afinal, eram os anos 70.
[2017-11-05 18:51:17] Felipe "Juca" Sanches: eu acho que o caminho √© interpretar todos os bytes de setup que o firmware escreve na porta 0x21 e assim ter a certeza de qual √© o ajuste que o firmware faz, portanto restringindo a quantidade de chutes necess√°rios. Teoricamente n√£o deveria ser necess√°rio chutar nada.
[2017-11-05 18:52:09] Werner Eck: vamos l√°
[2017-11-05 18:52:13] Werner Eck: deixa eu ver aqui
[2017-11-05 18:54:28] Felipe "Juca" Sanches: os bytes s√£o escritos nessa sequencia: 7A, 37, 40, X, 37 (com X = 7a, 4e ou 5a)
[2017-11-05 18:55:29] Werner Eck: isso
[2017-11-05 18:56:03] Werner Eck: acho q de cara o 37 √© invalido para mode... come√ßa escrevendo 2 zeros
[2017-11-05 18:57:20] Werner Eck: corrigindo, pode ser q esteja setando para modo sincrono
[2017-11-05 18:57:24] Werner Eck: deixa ler aqui
[2017-11-05 18:57:34] Felipe "Juca" Sanches: estou lendo tamb√©m
[2017-11-05 18:57:37] Felipe "Juca" Sanches: volto daqui a pouco
[2017-11-05 19:02:00] Felipe "Juca" Sanches: N√£o √© exatamente a t√©cnica usada aqui, mas parece que algo similar est√° acontecendo:
[2017-11-05 19:02:11] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_805513598_31818.jpg
[2017-11-05 19:03:29] Felipe "Juca" Sanches: ent√£o no nosso caso temos mode:7a command:37 seguido de comand:40(RESET) e mode:X command:37
[2017-11-05 19:03:31] Werner Eck: que parece ser o q o byte 0x40 faz
[2017-11-05 19:03:35] Werner Eck: hahaha
[2017-11-05 19:03:42] Werner Eck: para de ler pensamento cara
[2017-11-05 19:03:48] Felipe "Juca" Sanches: hehe
[2017-11-05 19:03:56] Werner Eck: eu acabei de decodificar ele
[2017-11-05 19:04:28] Werner Eck: concordo q 37 deve ser command
[2017-11-05 19:05:39] Felipe "Juca" Sanches: ent√£o vejamos quais informa√ß√µes de paridade, stop bits, start bits, baud-rate, etc que conseguimos extrair do mode:7a (e dos outros modes poss√≠veis: 4e ou 5a)
[2017-11-05 19:05:54] Felipe "Juca" Sanches: e depois vejamos o que o command:37 faz
[2017-11-05 19:06:28] Werner Eck: 0x7A=01 11 10 10: (modo ass√≠ncrono) 1 stop bit; paridade: habilitada, par; compr. palavra: 7 bits; fator baud rate: 16x
[2017-11-05 19:06:46] Werner Eck: modo 0x4e me parece ser assincrono tbm...
[2017-11-05 19:06:50] Werner Eck: estou lendo agora
[2017-11-05 19:09:14] Werner Eck: 0x4E=01 00 11 10: (modo ass√≠ncrono) 1 stop bit; paridade: desabilitada, √≠mpar; compr. palavra: 8 bits; fator baud rate: 16x
[2017-11-05 19:11:42] Werner Eck: 0x5A=01 01 10 10: (modo ass√≠ncrono) 1 stop bit; paridade: habilitada, √≠mpar; compr. palavra: 7 bits; fator baud rate: 16x
[2017-11-05 19:12:12] Werner Eck: s√£o singelas diferen√ßas no comprimento da palavra e paridade
[2017-11-05 19:12:29] Werner Eck: mas √© certo q est√° setando o USART em modo ass√≠ncrono sempre
[2017-11-05 19:12:53] Werner Eck: agora os command word
[2017-11-05 19:17:12] Werner Eck: 0x37=00 11 01 11: (command instruction): X (irrelevante - chip em ass√≠ncrono e modo command); RTS=0, PE=OE=FE=reset; normal operation (TxD=high), receive enable=1; DTR=0, transmit enable=1
[2017-11-05 19:17:36] Werner Eck: acho q √© isso
[2017-11-05 19:17:44] Werner Eck: pizza chegou, t√° servido?
[2017-11-05 19:17:55] Felipe "Juca" Sanches: hahaha, n√£o obrigado
[2017-11-05 19:18:08] Werner Eck: üçï
[2017-11-05 19:18:37] Werner Eck: domingo, nada melhor q pizza + cerveja e debugging de ROM
[2017-11-05 19:19:00] Felipe "Juca" Sanches: receive enable=1; junto com transmit enable=1 significa que ele est√° pronto a fazer ambos
[2017-11-05 19:19:10] Werner Eck: isso
[2017-11-05 19:19:24] Felipe "Juca" Sanches: n√£o sei se o terminal vai fazer algo com os dados entranto
[2017-11-05 19:19:44] Werner Eck: o neg√≥cio agora √© testar as combina√ß√µes poss√≠veis
[2017-11-05 19:20:10] Felipe "Juca" Sanches: talvez nesse momento inicial o operador precise fazer algo pra ativar o funcionamento (sair dessa tela de boot, esse splash screen com o nome do modelo no meio: "Sagitta 150 versao 4.00")
[2017-11-05 19:20:26] Werner Eck: pode ser... tem o manual do usu√°rio?
[2017-11-05 19:20:31] Felipe "Juca" Sanches: nope
[2017-11-05 19:20:44] Werner Eck: outra coisa, vc podia tentar for√ßar ele a carregar a ROM 0?
[2017-11-05 19:20:45] Felipe "Juca" Sanches: pera√≠... nunca procurei hahaha
[2017-11-05 19:20:49] Werner Eck: hahaha
[2017-11-05 19:20:56] Werner Eck: pizza, volto em instantes
[2017-11-05 19:21:00] Werner Eck: ou n√£o.. rsss
[2017-11-05 19:21:02] Werner Eck: brincadeira
[2017-11-05 19:45:12] Felipe "Juca" Sanches sent photo: /home/felipe/devel/github_garoa/Telegram_logs_Garoa_Hacker_Clube_Publico/media/Arqueologia_Digital_e_Preserva√ß√£o_Hist√≥rica_por_meio_da_Emula√ß√£o_de_Dispositivos_Eletr√¥nicos/download_804724256_59165.jpg
[2017-11-05 19:46:58] Felipe "Juca" Sanches: eu tive que adicionar ao driver uma fonte de sinal de clock para /TxC e /RxC
[2017-11-05 19:47:09] Felipe "Juca" Sanches: a frequencia que eu usei foi chutada (copiada de outro driver)
[2017-11-05 19:47:34] Felipe "Juca" Sanches: a√≠ com isso eu configurei o terminal gen√©rico com 1200 baud
[2017-11-05 19:47:59] Felipe "Juca" Sanches: e o terminal sagitta come√ßou a responder aos caracteres enviados pelo terminal gen√©rico
[2017-11-05 19:52:04] Felipe "Juca" Sanches: enviei um commit atualizando o c√≥digo do driver aqui: https://github.com/mamedev/mame/pull/2776/files
[2017-11-05 20:00:00] Werner Eck: CARAAAAAALHOOOOO!!!
[2017-11-05 20:00:11] Werner Eck: T√° funcionando o terminal!!!
[2017-11-05 20:01:01] Felipe "Juca" Sanches: :-)
[2017-11-05 20:01:13] Werner Eck: se conseguissemos emular uma porta serial mapeando pra um host ethernet, j√° pensou??
[2017-11-05 20:01:34] Felipe "Juca" Sanches: falta ainda emular o teclado do sagitta
[2017-11-05 20:01:56] Felipe "Juca" Sanches: que deve ser relacionado √†quela porta 0x50
[2017-11-05 20:02:25] Felipe "Juca" Sanches: e, sim, seria muito legal ligar esse sagitta emulado em alguma coisa moderna
[2017-11-05 20:02:37] Werner Eck: vc disse q pegou um CI que estava conectado ao teclado do sagitta, n√£o?
[2017-11-05 20:02:54] Felipe "Juca" Sanches: eu provavelmente vou depois tentar aprender como se faz o setup de sess√£o de login do GNU+Linux via pseudo-terminal
[2017-11-05 20:03:04] Werner Eck: verdade, fazer o sagitta mandar caracteres pra um terminal via ethernet
[2017-11-05 20:03:36] Felipe "Juca" Sanches (in reply to Werner Eck): n√£o... era a ROM do gerador de catacteres e o pr√≥prio CRTC que estavam escondidos debaixo do painel met√°lico do teclado
[2017-11-05 20:03:45] Werner Eck: por exemplo, uma maquina emulando um host ibm
[2017-11-05 20:03:56] Werner Eck: ah t√°
[2017-11-05 20:04:03] Werner Eck: e o circuito do teclado?
[2017-11-05 20:04:07] Felipe "Juca" Sanches: ah sim! O pr√≥prio MAME pode emular m√°quinas que trabalham com terminais seriais
[2017-11-05 20:04:56] Felipe "Juca" Sanches: eu n√£o estudei o circuito do teclado l√° na usp
[2017-11-05 20:05:21] Werner Eck: http://mainframewizard.com/content/free-mainframe-emulators
[2017-11-05 20:05:34] Felipe "Juca" Sanches: e existe sim a possibilidade de ter algum circuito integrado adicional que eu n√£o vi, por que uma parte da pcb ainda ficou encoberta por uma outra chapa met√°lica
[2017-11-05 20:05:37] Werner Eck: blz, isso fica pra pr√≥xima etapa
[2017-11-05 20:05:53] Felipe "Juca" Sanches: mas talvez d√™ pra inferir isso s'por an√°lise do firmware como fizemos at√© agora mesmo
[2017-11-05 20:06:12] Felipe "Juca" Sanches: agora eu vou sair (vou no cinema assistir o novo Blade Runner)
[2017-11-05 20:06:17] Felipe "Juca" Sanches: acho que por hoje √© s√≥
[2017-11-05 20:06:48] Werner Eck: por exemplo, esse: http://www.datasheetcatalog.com/datasheets_pdf/8/2/7/9/8279.shtml
[2017-11-05 20:07:00] Werner Eck: ow esse filme deve ser mto bom
[2017-11-05 20:07:11] Werner Eck: blz - foi bom, rendeu bastante
[2017-11-05 20:07:28] Werner Eck: N√£o esperava ver o sagitta emulado t√£o r√°pido
[2017-11-05 20:15:59] Felipe "Juca" Sanches: :-)
[2017-11-05 20:16:06] Felipe "Juca" Sanches: t√© mais
[2017-11-05 20:16:11] Felipe "Juca" Sanches: e Happy Hacking !
[2017-11-05 20:16:27] Werner Eck: üòÑüëç
